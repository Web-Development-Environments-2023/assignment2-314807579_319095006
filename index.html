<!DOCTYPE html>
<html lang="en">
	<head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<meta charset="utf-8">
        <link rel="stylesheet" href="styles.css">
        <link rel="icon" href="logo.jpg" type="image/png">
		<title>Chicken Invaders</title>
        <style type = "text/css">
         canvas{ border: 1px solid black; }
        </style>
        <script src="chicken.js"></script>
	</head>
	<body>
        <div ALIGN="center">
        </div>
        <div id="menu">
            <nav>
                <ul>
                    <li onclick="welcome()">Home</li>
                    <li onclick="login()">Login</li>
                    <li onclick="about()">About</li>
                    <li onclick="signup()">Sign up</li>
                </ul>
            </nav>
            <script>
                
            </script>
        </div>
        <content> 
            <div id="welcome page" ALIGN="center">
                <h1>Welcome to Chicken Invaders!</h1>
                <h4 style="align-items: center;">Or Fuchs 319095006, Amit Vitkovsky 314807579</h4>
                <button id="Login " onclick=login() >Login</button>
                <button id="sign up" onclick="signup()">Sign Up</button>
                <h1><image src="images/BigChickenCIU.webp" alt="chicken" width="200" height="200"></h1>
                <script>
                    
                </script>
            </div>

            <div id="login page" style="display: none;" >
                <h1>Login</h1>
                <form name="loginForm" onsubmit="return valid(event)">
                    <label for="in_username">Username:</label>
                    <input type="text" id="in_username" name="in_username" required><br><br>
                    <label for="in_password">Password:</label>
                    <input type="password" id="in_password" name="in_password" required><br><br>
                    <input type="submit" value="Submit" > 
                </form>
                <button id="back" onclick="back()">Back</button>
                <script>
                    function back(){
                        document.getElementById("login page").style.display = "none";
                        document.getElementById("welcome page").style.display = "block";
                    }
            
                    function valid(event)
                    {
                        event.preventDefault();
                        var username = document.getElementById("in_username").value;
                        var password = document.getElementById("in_password").value;
                        for (var i = 0; i < validCredentials.length; i++) {
                            if (username === validCredentials[i].username && password === validCredentials[i].password) {
                                document.getElementById("login page").style.display="none";
                                document.getElementById("game page").style.display="none";
                                document.getElementById("theCanvas").style.display="none";
                                document.getElementById("welcome page").style.display="none";
                                document.getElementById("about").style.display = "none";
                                document.getElementById("configuration").style.display="block";
                                document.addEventListener("keydown", config);
                                best_scores = [];
                                return;
                            }
                        }
                        alert("Invalid username or password");
                        return;
                    }
                </script>
            </div>

            <div id="sign up page" style="display:none;">
                <h1>Sign Up</h1>
                <form name="myForm" onsubmit="return check(event)">
                    <label for="username">Username:</label>
                    <input type="text" id="username" name="username" required><br><br>
                    <label for="password">Password:</label>
                    <input type="password" id="password" name="password" minlength="8" required><br><br>
                    <label for="password2">Confirm Password:</label>
                    <input type="password" id="password2" name="password2" minlength="8" required><br><br>
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required><br><br>
                    <label for="first">First Name:</label>
                    <input type="text" id="first" name="first" required><br><br>
                    <label for="last">Last Name:</label>
                    <input type="text" id="last" name="last" required><br><br>
                    <label for="dob">Date of Birth:</label>
                    <input type="date" id="dob" name="dob" required><br><br>
                    <input type="submit"  id="submit" value="Submit">
                </form>
                <button id="back" onclick="backSignUp()">Back</button>
                <script>

                    function backSignUp(){
                        
                        document.getElementById("sign up page").style.display = "none";
                        document.getElementById("welcome page").style.display = "block";
                    }
                </script>
            </div>

            <div id="game page" style="display: none;" ALIGN="center">
                <script src="chicken.js"></script>
                    <div id="canvasDiv" style="display: flex; flex-direction: row;">
                        <h4>
                            <!-- <span id="timer"></span><br>
                            <span id="score-value"></span> <br> 
                            <span id="lives-value"></span> -->
                            <div id="timer" ></div>
                            <style>
                                #timer {
                                    font-size: 15px;
                                    color: rgb(8, 8, 8);
                                    text-align: center;
                                    width: 80%;
                                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                }
                            </style>
                            <br>
                            <div id="score-value"></div>
                            <style>
                                #score-value {
                                    font-size: 15px;
                                    color: rgb(8, 8, 8);
                                    text-align: center;
                                    width: 80%;
                                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                }
                            </style>
                            <br>
                            <div id="lives-value"></div>
                            <style>
                                #lives-value {
                                    font-size: 15px;
                                    color: rgb(8, 8, 8);
                                    text-align: center;
                                    width: 80%;
                                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                                }
                            </style>
                            <br>
                            <button id="newGame"onclick="startByButton()" >new Game </button>
                            <script>
                                function startByButton(){
                                    document.getElementById("game page").style.display="none";
                                    document.getElementById("theCanvas").style.display="none";
                                    document.getElementById("game page").style.display="block";
                                    document.getElementById("theCanvas").style.display="block";
                                    startgame()
                                    }
                            </script> 
                        </h4>
                        <canvas id = "theCanvas" width = "1000" height = "500"  ALIGN="center"></canvas> 
                    </div>
                    <script>
                        const scoreElement = document.getElementById("score-value")
                        function updateScore(){
                            var points = score
                            scoreElement.innerHTML = "Score:\n" + points;
                            if (score === 250) {
                                best_scores.push(score)
                                showScores()  
                                startgame()
                                
                            }
                        }
                        updateScore();
                        const lives_element = document.getElementById("lives-value")
                        function updateLives(){
                            var Lnum = lives
                            lives_element.innerHTML = "Lives remaining:\n" + Lnum;
                            if (lives === 0){
                                
                                best_scores.push(score) 
                                showScores()                               
                                startgame()
                            }
                        }
                        updateLives();
                    </script>
              
            </div>

            <dialog id="about">
                <div id="myAbout">About:</div>
                <button id="exit-button" onclick="closeDialog()">Close</button>
                <script>
                   
                </script>
                
            
            </dialog>

            <dialog id="scoreTable">
                <button id="exit-button" onclick="closeScoreDialog()">Close</button>
                <div id ="scoreTable-value"> </div>
                <script>
                    function closeScoreDialog(){
                        document.getElementById("scoreTable").style.display ="none";
                    }
                    scoreTableElement =document.getElementById("scoreTable-value")
                    function showScores() {
                        if (lives === 0){
                            scoreTableElement.innerHTML = ("             You Lost<br><br>")
                        }
                        else if(score === 250){
                            scoreTableElement.innerHTML = ("             Champion<br><br>")
                        }
                        else{
                            if(score >=100){
                            scoreTableElement.innerHTML = ("              Winner<br><br>")
                            }
                            else{
                                scoreTableElement.innerHTML = ("             You can do better<br><br>")
                            }
                        }
                        // Get the best scores list and the player's last score
                        var bestScores = best_scores;
                        var new_score = score;
                        
                        // Sort the scores in descending order
                        var sortedScores = bestScores.slice().sort(function(a, b) {
                            return b - a;
                        });
                        
                        // Create a list of score items with position and value
                        var scoreItems = sortedScores.map(function(s, i) {
                            var item = s;
                            if (s == score) {
                                item = s + " (Your Score)";
                            }
                            return (i+1) + ". " + item;
                        });
                        scoreTableElement.innerHTML +=("Player Scores:<br>" + scoreItems.join("<br>"));
                        document.getElementById("scoreTable").style.display ='block'
                    }
                    document.addEventListener("mouseup", function(event){
                        var dialog = document.getElementById("scoreTable")
                        if (event.target != dialog && event.target.parentNode != dialog ) {
                            
            // Close the dialog if it is open
                    if (dialog.style.display == "block") {
                        dialog.style.display = "none";
                    }
                }  

                    })
                </script>
                
            </dialog>


            <div id="configuration" style="display: none;">
                <style>
                    #configuration {
                        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                        font-size: 20px;
                    }
                    #configuration input {
                        display: inline-block;
                        height: 30px;
                        font-size: 20px;
                        border: 1px solid #ccc;
                        border-radius: 4px;
                        
                    }
                </style>
                <form name="config" onsubmit="return  game_after_config(event)">
                    <label for="shootKeyInput">I want to shoot with:</label>
                    <input type="text" id="shootKeyInput" name="shootKeyInput" placeholder="SpaceBar or Letter" required >
                    <br><br>
                    <label for="gameLengthInput">Enter game length (in minutes):</label>
                    <input type="number" id="gameLengthInput" name="gameLengthInput" placeholder="2+" min="2" required>
                    <br><br>
                    <input type="submit" value="Start Game" >
                    <script>
    
                    </script>
            </div>
        </content>

        <footer>
            <h5>Created by: Amit Vitkovsky, Or Fuchs</h5>
        </footer>

	</body>
</html>
